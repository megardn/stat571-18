---
title: " Modern Data Mining, HW 1"
author:
- Joelle Bagautdinova
- Diego Davila
- Margaret Gardner
date: 'Due: 11:59PM,  Jan. 30th, 2021'
output:
  pdf_document:
    number_sections: yes
    toc: yes
    toc_depth: '4'
  html_document:
    code_folding: show
    highlight: haddock
    number_sections: yes
    theme: lumen
    toc: yes
    toc_depth: 4
    toc_float: yes
  word_document:
    toc: yes
    toc_depth: '4'
urlcolor: blue
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, results = "hide", fig.width=8, fig.height=4)
options(scipen = 0, digits = 3)  # controls base R output
# check if you have ISLR package, if not, install it
if(!require('pacman')) {install.packages('pacman')}
pacman::p_load(ISLR, readxl, tidyverse, magrittr, dplyr, ggplot2, haven, tidycensus, ggpubr)
```


\pagebreak

# Case study 1: Audience Size

## Data preparation

Loading survey data.
``` {r c1 load.mturk, echo=FALSE}
#read data into df from csv and replacing blanks with NA
mturk <- read.csv("data/Survey_results_final.csv", header = TRUE, stringsAsFactors = F, na = "") 
#colnames(mturk)
```

i. Selecting and renaming only specified variables of interest for clarity.

``` {r filt&rename, echo=FALSE}
#write new df filtered to desired columns and rename column headers
radio <- mturk %>% select(Answer.Age, Answer.Gender, Answer.Education, Answer.HouseHoldIncome, Answer.Sirius.Radio, Answer.Wharton.Radio, WorkTimeInSeconds) %>% rename(age = Answer.Age, gender = Answer.Gender, education = Answer.Education, income = Answer.HouseHoldIncome, sirius = Answer.Sirius.Radio, wharton = Answer.Wharton.Radio, worktime = WorkTimeInSeconds)

#visualize data
head(radio, 5)
str(radio)
sum(is.na(radio))
```

ii. Handling missing/wrongly filled values of the selected variables

Generally, data may be wrong or incorrect if participants were confused by the instructions or inattentive to the survey.

Dropping any respondents who are missing answers for listening to Sirius Radio or Wharton radio, since this data won't be usable for our analyses. Further, because the Wharton talk show is hosted on the Sirius platform, any subjects who reported listening to the Wharton radio show but not to Sirius Radio were excluded on the basis of input error.

``` {r sirius.correct}
radio <- radio %>% drop_na(sirius) %>% drop_na(wharton) #drop any rows missing sirius/wharton listenership, since that's what we care about most

#remove nonsense subjects
radio[!(radio$sirius == "No" & radio$wharton == "Yes"),]
```

Cleaning age data to ensure data is a continuous numerical. Dropping any datapoints outside the range of 18 to 110 years which are likely erroneous; MTurk requires that workers be at least 18 years old and age above 110 is rare.
``` {r age.correct}
#find variables in age with no numerical component
parse_number(radio$age) 

#replace chr variables identified above with NA and recover entries with both chr & int data via parse_number()
radio <- radio %>% mutate(age = parse_number(age, na="female")) 

#now that age is numeric, drop data outside reasonable age range (must be 18+ to work for mturk):
radio %>% summarise(min=min(age, na.rm=T), max=max(age, na.rm=T))
is.na(radio$age) <- which(radio$age < 18 | radio$age >110)
```


Cleaning categorical variables by marking as factors and ordering levels as appropriate for inherently ranked categories (i.e. education, income).
```{r factor.correct}
#converting categorical data to factors:
radio <- radio %>% mutate(gender = as.factor(gender),
          education = as.factor(education),
          income = as.factor(income),
          sirius = as.factor(sirius),
          wharton = as.factor(wharton))
#listing unique levels to make sure all make sense
radio %>% sapply(levels)

#clean up education:
  #replace unselected education values with NA
is.na(radio$education) <- which(radio$education == "select one") 
  #drop the now unused "select one" level
radio$education <-droplevels(radio$education) 
  #reorder
radio$education<- factor(radio$education, levels=c("Less than 12 years; no high school diploma", "High school graduate (or equivalent)", "Some college, no diploma; or Associate’s degree", "Bachelor’s degree or other 4-year degree", "Graduate or professional degree", "Other"))

#reordrer income levels
radio$income<- factor(radio$income, levels=c("Less than $15,000", "$15,000 - $30,000", "$30,000 - $50,000", "$50,000 - $75,000", "$75,000 - $150,000", "Above $150,000"))
```

Check worktime variable to ensure data is reasonable, no changes needed.
``` {r worktime.correct}
#look at worktime - automatically calculated by site and all seem to make sense, no corrections needed
sum(is.na(radio$worktime))
radio %>% summarise(min=min(worktime, na.rm=T), max=max(worktime, na.rm=T), mean=mean(worktime))
```

iii. Brief summary 

Usable data was obtained from `r nrow(radio)` subjects. Of these, `r (sum(!complete.cases(radio))/n)*100`% of subject's data was incomplete (i.e. missing one or more demographic variables). The number of usable responses for each variable is shown below:

``` {r summary1, echo=FALSE}
#sample size for each variable
sapply(radio, function(x) sum(!is.na(x))) 
```

Summary statistics for each variable - including frequency of categorical responses, mean range of continuous variables, and counts for missing values - are displayed below:

``` {r summary2, echo=FALSE}
#summary of all data
summary(radio)
```

The distribution of respondents' ages is plotted below. Respondents ages ranged from `r min(age, na.rm=T)` to ` r max(age, na.rm=T)` years with a mean of `r mean(age, na.rm=T)` years. 
``` {r age.plot}
a <- ggplot(radio, aes(x=age)) + 
  geom_histogram(bins=25, color="white", fill= "darkblue" ) +
  labs(title="Reported age survey respondents")
a
```

Respondents' reported educational attainment is plotted below. 
``` {r education.plot}
redu <- radio %>% drop_na(education) #drop missing education values prior to plotting

d<- ggplot(redu) + 
  geom_bar(aes(x=education), stat="count", fill="darkblue") + 
  theme(axis.text.x = element_text(angle = 60, hjust=1)) + 
  ggtitle("Reported education of survey respondents")
d
```
Respondents most frequently reported having completed some college or An associate's degree (`r (sum(redu$education == "Some college, no diploma; or Associate’s degree")/nrow(redu))*100`% of `r nrow(redu)` subjects for whom education data was available).

Listening habits of all survey respondents are plotted below. Most respondents reported listening to Sirius Radio stations, which may indicate that MTurk workers who listen to Sirius were more likely to opt-into completing a survey about Sirius Radio.
``` {r wharton.plot}
w<- ggplot(radio, aes(x=sirius, fill=wharton)) + 
  geom_bar(stat="count") + 
  scale_fill_brewer(palette="Blues") + 
  labs(title="Reported listening habits of survey respondents", x="Listen to Sirius Radio") + 
  guides(fill=guide_legend(title="Listen to Wharton Radio Show")) 
w
```



Reported household income was plotted among those who do and do not listen to Wharton's radio show. Respondents most frequently reported an annual household income of \$30-$50,000. 
``` {r income.plot}
rinc <- radio %>% drop_na(income) #drop missing income values prior to plotting

i<- ggplot(rinc, aes(x=income, fill=wharton)) + 
  geom_bar(stat="count") +
  labs(title="Reported household income and listenership of survey respondents", x="Annual Household Income") + 
  guides(fill=guide_legend(title="Listen to Wharton Radio Show")) 
i
```
While the number of individuals in each bracket varies considerably across income levels, the count of individuals who listen to Wharton radio appears relatively stable across income brackets. We further probed the possible relationship of income and listening to Wharton's radio show by calculating the percentage of total respondents in each income bracket who report listening to Wharton radio, plotted below. The income group with the greatest percentage of Wharton radio listeners was those earning over \$150,000 per year.
```{r listenerincome.plot, echo=FALSE}
#count subj in each income bracket who listen to wharton
neww <- radio %>% group_by(income, wharton) %>% count(wharton) %>% filter(wharton=="Yes")
#count subjects in each income bracket
newi <- radio %>% group_by(income) %>% count(income) %>% rename(total=n)
#merge dataframes and calculate percentage
newmerge <- inner_join(neww, newi, by="income") %>% mutate(prcnt=(n/total)*100)

#plot
prc<- ggplot(newmerge) + 
  geom_col(aes(x=income, y=prcnt),fill="darkblue")+
  labs(title="Percent respondents listening to Wharton radio by household income", x="Annual Household Income", y ="Percent listening to Wharton radio") +
  ylim(0,100)
prc
```

The distribution of the time taken by each respondents to complete the survey is plotted below. Respondents time to completion ranged from `r min(worktime, na.rm=T)` to ` r max(worktime, na.rm=T)` seconds with a mean of `r mean(worktime, na.rm=T)` seconds. 
``` {r worktime.plot}
t <- ggplot(radio, aes(x=worktime)) + 
  geom_histogram(bins=25, color="white", fill= "darkgreen") + 
  labs(title="Time to survey completion", x = "Worktime (sec)")
t
```

## Sample properties

The population from which the sample is drawn determines where the results of our analysis can be applied or generalized. We include some basic demographic information for the purpose of identifying sample bias, if any exists. Combine our data and the general population distribution in age, gender and income to try to characterize our sample on hand.

i. Does this sample appear to be a random sample from the general population of the USA?
ii. Does this sample appear to be a random sample from the MTURK population?

### Comparison to General Population
Data describing the demographics of the US general population was obtained from the 2014 American Community Survey, data available from the US Census Bureau [here](https://data.census.gov/cedsci/). 


```{r load.acs}
#define API key for loading census data
census_key <- "6df3ff65073680a1ec1a64376da84217f13d7a53"

#load variable names of ACS data
acsvars <- load_variables(2014, "acs1", cache=TRUE)

#load ACS data on sex & age

acsage <- get_acs(geography="us", table = "B01001", year=2014, key=census_key, survey="acs1")
#recode variable names and split out gender
usage <- acsvars %>% inner_join(acsage, by=c("name"="variable"), keep=FALSE) %>% select(label, estimate) 
usage$label <- gsub("Estimate!!Total!!","", as.character(usage$label))
usage <- usage %>% separate(label, c("gender", "age"), "!!")
#keep only relevant age bins (>=18)
keep<- c("18 and 19 years", "20 years", "21 years", "22 to 24 years", "25 to 29 years", "30 to 34 years", "35 to 39 years", "40 to 44 years", "45 to 49 years", "50 to 54 years", "55 to 59 years", "60 and 61 years", "62 to 64 years", "65 and 66 years", "67 to 69 years", "70 to 74 years", "75 to 79 years", "80 to 84 years", "85 years and over")
subage <- usage[usage$age %in% keep,]
subage

#plot US census age and sex vs sample 
samp_age <- radio %>% drop_na(gender, age) 
page1 <- ggplot(samp_age, aes(x=age, fill=gender)) + 
  geom_histogram(bins=20, color="white") +
  labs(title="Survey respondents")
page2 <- ggplot(subage, aes(x=age, y=estimate, fill=gender)) + 
  geom_bar(stat="identity") +
  theme(axis.text.x = element_text(angle = 60, hjust=1)) + 
  labs(title="US population", y="count")

# put p1 and p2 together
comp1 <- ggpubr::ggarrange(page1, page2, common.legend = T, legend = "bottom", ncol = 2)
annotate_figure(p=comp1, top = text_grob("Age and Gender of Survey Respondents vs US General Population", 
                               color = "black", face = "bold", size = 14))
```

``` {r load.usa}
#load ACS data on education

acsedu <- get_acs(geography="us", table = "B15001", year=2014, key=census_key, survey="acs1")

#recode variable names and split out gender, age and education
usedu <- acsvars %>% inner_join(acsedu, by=c("name"="variable"), keep=FALSE) %>% select(label, estimate) 
usedu$label <- gsub("Estimate!!Total!!","", as.character(usedu$label))
usedu <- usedu %>% separate(label, c("gender", "age", "education"), "!!") %>% mutate(education=as.factor(education))
levels(usedu$education)

#keep only rows with education info and reorder factor levels
keep2 <- c("Less than 9th grade", "9th to 12th grade, no diploma", "High school graduate (includes equivalency)", "Some college, no degree", "Associate's degree", "Bachelor's degree", "Graduate or professional degree")
usedu$education<-factor(usedu$education, levels=keep2)
subedu <- usedu[usedu$education %in% keep2,]
#aggregate across gender and age since we just want education
subedu <- subedu %>% group_by(education) %>% summarize(estimate=sum(estimate))

#plot US census education vs sample 
pedu1 <- ggplot(redu) + 
  geom_bar(aes(x=education), stat="count", fill="darkblue") + 
  theme(axis.text.x = element_text(angle = 60, hjust=1)) + 
  labs(title="Survey respondents")
pedu2 <- ggplot(subedu, aes(x=education, y=estimate)) + 
  geom_bar(stat="identity", fill="darkgreen") +
  theme(axis.text.x = element_text(angle = 60, hjust=1)) + 
  labs(title="US population", y="count")

# put p1 and p2 together
comp2 <- ggpubr::ggarrange(pedu1, pedu2, common.legend = T, legend = "bottom", ncol = 2)
annotate_figure(p=comp2, top = text_grob("Education of Survey Respondents vs US General Population", 
                               color = "black", face = "bold", size = 14))
```

``` {r load.usa}
#load ACS data on income
acsinc <- get_acs(geography="us", table = "B19037", year=2014, key=census_key, survey="acs1")

#recode variable names and split out age and education
usinc <- acsvars %>% inner_join(acsinc, by=c("name"="variable"), keep=FALSE) %>% select(label, estimate) 
usinc$label <- gsub("Estimate!!Total!!","", as.character(usinc$label))
usinc <- usinc %>% separate(label, c("age", "income"), "!!") %>% mutate(income=as.factor(income))
levels(usinc$income)

#keep only rows with income info and reorder factor levels
keep3 <- c("Less than $10,000", "$10,000 to $14,999", "$15,000 to $19,999", "$20,000 to $24,999", "$25,000 to $29,999", "$30,000 to $34,999", "$35,000 to $39,999", "$40,000 to $44,999", "$50,000 to $59,999", "$60,000 to $74,999", "$75,000 to $99,999", "$100,000 to $124,999", "$125,000 to $149,999", "$150,000 to $199,999", "$200,000 or more")
usinc$income<-factor(usinc$income, levels=keep3)
subinc <- usinc[usinc$income %in% keep3,]
#aggregate across age since we just want income
subinc <- subinc %>% group_by(income) %>% summarize(estimate=sum(estimate))

#plot US census income vs sample 
pinc1 <- ggplot(rinc) + 
  geom_bar(aes(x=income), stat="count", fill="darkblue") + 
  theme(axis.text.x = element_text(angle = 60, hjust=1)) + 
  labs(title="Survey respondents")
pinc2 <- ggplot(subinc, aes(x=income, y=estimate)) + 
  geom_bar(stat="identity", fill="darkgreen") +
  theme(axis.text.x = element_text(angle = 60, hjust=1)) + 
  labs(title="US population", y="count")

# put p1 and p2 together
comp3 <- ggpubr::ggarrange(pinc1, pinc2, common.legend = T, legend = "bottom", ncol = 2)
annotate_figure(p=comp3, top = text_grob("Income of Survey Respondents vs US General Population", 
                               color = "black", face = "bold", size = 14))
```


### Comparison to MTURK Population
Data describing the demographics of MTURK workers in the US is from Moss et al and obtained [here](https://osf.io/w7e8p/?view_only=37f51a62db6144a2950646975887bac9). Data was collected in 2019.

scales are different....

``` {r load.mturk.demo}
mpop <- as.data.frame(read_sav("data/MTurkEthics_Study1_Data.sav")) #load mturk data
#names(mpop)
mpop <- mpop %>% select(age, Whatisyourgender, Whatisthehighestlevelofschoolyouhavecompletedorthehighestdegreey, Thinkingbackoverthelastyearwhatwasyourfamilysannualincomeincludi) %>% rename(gender=Whatisyourgender, education=Whatisthehighestlevelofschoolyouhavecompletedorthehighestdegreey, income=Thinkingbackoverthelastyearwhatwasyourfamilysannualincomeincludi) #subset and rename columns
mpop
```

## Final estimate

``` {r siruis, echo=FALSE}
#estimating listenership 
slisten <- sum(radio$sirius == "Yes") #num subj who listen to sirius xm
wlisten <- sum(radio$wharton == "Yes") #num subj who listen to wharton radio
p <- (wlisten/slisten) #proportion sirius listeners who listen to wharton
p*100 #percent subj listening to sirius who listen to wharton
```

The Wharton radio listenership comprised of approximately ***`r prettyNum(p*51.6*100000, big.mark = ",")` individuals*** in January 2014, assuming that the study sample's reported listening habits are representative of the general population.

The aim of the present study was to estimate the audience size of radio show Business Radio Powered by the Wharton School (Wharton Radio), available on Sirius Radio. Audience size was estimated by assessing the proportion of Sirius Radio listeners who reported listening to the Wharton talk show. Data was collected via survey on Amazon's Mechanical Turk (MTurk) platform in May 2014. Of `r n` survey respondents, `r prettyNum(wlisten, big.mark = ",")` of  `r prettyNum(slisten, big.mark = ",")` Sirius Radio listeners reported listening to Wharton radio (`r p*100`%). This ratio was extrapolated to the approximately 51.6 million Sirius listeners in 2014, resulting in an estimated `r prettyNum(p*51.6*100000, big.mark = ",")` listeners to Wharton radio. This finding is limited by sampling methodology, which was restricted to individuals enrolled in MTurk and may not be representative of Sirius Radio listeners. 


## New task

Now suppose you are asked to design a study to estimate the audience size of Wharton Business Radio Show as of today: You are given a budget of $1000. You need to present your findings in two months. 

Write a proposal for this study which includes:

1. Method proposed to estimate the audience size.
2. What data should be collected and where it should be sourced from.
Please fill in the google form to list your platform where surveys will be launched and collected [HERE](https://forms.gle/8SmjFQ1tpqr6c4sa8) 

A good proposal will give an accurate estimation with the least amount of money used. 





# Case study 2: Women in Science


Are women underrepresented in science in general? How does gender relate to the type of educational degree pursued? Does the number of higher degrees increase over the years? In an attempt to answer these questions, we assembled a data set (`WomenData_06_16.xlsx`) from [NSF](https://ncses.nsf.gov/pubs/nsf19304/digest/field-of-degree-women) about various degrees granted in the U.S. from 2006 to 2016. It contains the following variables: Field (Non-science-engineering (`Non-S&E`) and sciences (`Computer sciences`, `Mathematics and statistics`, etc.)), Degree (`BS`, `MS`, `PhD`), Sex (`M`, `F`), Number of degrees granted, and Year.

Our goal is to answer the above questions only through EDA (Exploratory Data Analyses) without formal testing. We have provided sample R-codes in the appendix to help you if needed. 


## Data preparation  

1. Understand and clean the data

Notice the data came in as an Excel file. We need to use the package `readxl` and the function `read_excel()` to read the data `WomenData_06_16.xlsx` into R. 


i. Read the data into R.
ii. Clean the names of each variables. (Change variable names to  `Field`,`Degree`, `Sex`, `Year` and `Number` )
iii. Set the variable natures properly. 
iv. Any missing values?

2. Write a summary describing the data set provided here. 

i. How many fields are there in this data?
ii. What are the degree types? 
iii. How many year's statistics are being reported here? 



## BS degrees in 2015

Is there evidence that more males are in science-related fields vs `Non-S&E`? Provide summary statistics and a plot which shows the number of people by gender and by field. Write a brief summary to describe your findings.

## EDA bringing type of degree, field and gender in 2015

Describe the number of people by type of degree, field, and gender. Do you see any evidence of gender effects over different types of degrees? Again, provide graphs to summarize your findings.

## EDA bring all variables 

In this last portion of the EDA, we ask you to provide evidence numerically and graphically: Do the number of  degrees change by gender, field, and time? 

## Women in Data Science

Finally, is there evidence showing that women are underrepresented in data science? Data science is an interdisciplinary field of computer science, math, and statistics. You may include year and/or degree.

## Final brief report

Summarize your findings focusing on answering the questions regarding if we see consistent patterns that more males pursue science-related fields. Any concerns with the data set? How could we improve on the study?

## Appendix

To help out, we have included some R-codes here as references. You should make your own chunks filled with texts going through each items listed above. Make sure to hide the unnecessary outputs/code etc. 

1. Clean data

```{r data wrangling, echo = FALSE, warning = FALSE}
# For the demonstration purpose, we show this R-chunk by taking echo=TRUE
# In your final report you should hide all the R-chunks to keep your report flowing well.
wsci <- read_excel("WomenData_06_16.xlsx")
names(wsci)
head(wsci)
#change names
wsci %<>% 
  rename(Field = 'Field and sex')
# set the field, degree and sex as factors
wsci %<>% 
  mutate( Field = as.factor(Field))
```


```{r, echo=FALSE}
# wsci %<>%
#   rename(Field = "Field and sex",
#          Number = "Degrees Awarded") %>%
#   mutate(Field = as.factor(Field),
#          Degree = as.factor(Degree),
#          Sex = as.factor(Sex))

```


2. A number of sample analyses 

```{r eval = FALSE, echo = FALSE}
wsci %>%  # to get the average number of ppl by gender
  group_by(Field, Sex) %>%
  summarise(deg = mean(Number))

wsci %>%
  filter(Year == 2007) %>%
  ggplot(aes(x = Field, y = Number, fill = Sex)) +
  geom_bar(stat = "identity", position = "dodge") +
  facet_grid(Degree~., scales = "free_y") +
  theme(axis.text.x = element_text(angle = 30, hjust = 1)) +
  ggtitle("Degrees granted across fields by degree and gender") 

wsci %>%
  mutate(SE = ifelse(Field!="Non-S&E" , "S&E", "Non-S&E")) %>%
  group_by(SE, Sex) %>%
  summarise(SE_number = sum(Number)) %>%
  ggplot(aes(x = SE, y = SE_number, fill = Sex)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme(axis.text.y = element_text(angle = 60)) +
  ggtitle("Degrees granted by S&E vs non-S&E by gender")

wsci %>%
  mutate(SE = ifelse(Field!="Non-S&E" , "S&E", "Non-S&E")) %>%
  group_by(SE, Sex, Year) %>%
  summarise(SE_number = sum(Number)) %>%
  group_by(SE, Year) %>%
  mutate(ratio = SE_number / sum(SE_number)) %>%
  filter(Sex == "Female") %>%
  ggplot(aes(x = Year, y = ratio, color = SE)) +
  geom_point() + geom_line() +
  ggtitle("Female proportion in SE/non-SE across year")

wsci %>%
  mutate(SE = ifelse(Field!="Non-S&E" , "S&E", "Non-S&E")) %>%
  group_by(SE, Sex, Year, Degree) %>%
  summarise(SE_number = sum(Number)) %>%
  group_by(SE, Year, Degree) %>%
  mutate(ratio = SE_number / sum(SE_number)) %>%
  filter(Sex == "Female") %>%
  ggplot(aes(x = Year, y = ratio, color = SE)) +
  geom_point() + geom_line() +
  facet_grid(~Degree)+
  ggtitle("Female proportion in SE/non-SE across year by degree")


wsci %>%
  mutate(SE = ifelse(Field!="Non-S&E" , "S&E", "Non-S&E")) %>%
  group_by(SE, Sex, Year, Degree) %>%
  summarise(SE_number = sum(Number)) %>%
  ggplot(aes(x = Year, y = SE_number, fill = Sex)) +
  geom_bar(stat = "identity", position = "dodge") +
  facet_grid(SE~Degree, scales = "free_y") +
  ggtitle("Degrees granted by sex, degree and SE")


wsci %>%
  mutate(SE = ifelse(Field!="Non-S&E" , "S&E", "Non-S&E")) %>%
  group_by(SE, Sex, Year, Degree) %>%
  summarise(SE_number = sum(Number)) %>%
  ggplot(aes(x = Year, y = SE_number, fill = Sex)) +
  geom_bar(stat = "identity", position = "fill") +
  facet_grid(SE~Degree, scales = "free_y") +
  ggtitle("Degrees granted proportion by sex across degree and SE")


wsci %>%
  filter(Field %in% c("Computer sciences", "Mathematics and statistics")) %>%
  ggplot(aes(x = Year, y = Number, fill = Sex)) +
  geom_bar(stat = "identity", position = "dodge") +
  facet_grid(Field~Degree, scales = "free_y") +
  ggtitle("Degrees granted pr option by sex across degree and SE")


wsci %>%
  ggplot(aes(x = Year, y = Number, fill = Sex)) +
  geom_bar(stat = "identity", position = "dodge") +
  facet_grid(Field~Degree, scales = "free_y") +
  ggtitle("Degrees granted proportion by sex across degree and SE")
```




# Case study 3: Major League Baseball

We would like to explore how payroll affects performance among Major League Baseball teams. The data is prepared in two formats record payroll, winning numbers/percentage by team from 1998 to 2014. 

Here are the datasets:

-`MLPayData_Total.csv`: wide format
-`baseball.csv`: long format

Feel free to use either dataset to address the problems. 

## EDA: Relationship between payroll changes and performance

Payroll may relate to performance among ML Baseball teams. One possible argument is that what affects this year's performance is not this year's payroll, but the amount that payroll increased from last year. Let us look into this through EDA. 

Create increment in payroll

i. To describe the increment of payroll in each year there are several possible approaches. Take 2013 as an example:

    - option 1: diff: payroll_2013 - payroll_2012
    - option 2: log diff: log(payroll_2013) - log(payroll_2012)

Explain why the log difference is more appropriate in this setup.

ii. Create a new variable `diff_log=log(payroll_2013) - log(payroll_2012)`. Hint: use `dplyr::lag()` function.

iii. Create a long data table including: team, year, diff_log, win_pct


## Exploratory questions

i. Which five teams had highest increase in their payroll between years 2010 and 2014, inclusive?

ii. Between 2010 and 2014, inclusive, which team(s) "improved" the most? That is, had the biggest percentage gain in wins?


## Do log increases in payroll imply better performance? 

Is there evidence to support the hypothesis that higher increases in payroll on the log scale lead to increased performance?

Pick up a few statistics, accompanied with some data visualization, to support your answer. 

## Comparison

Which set of factors are better explaining performance? Yearly payroll or yearly increase in payroll? What criterion is being used? 






